$(document).ready(function(){var a=$("#couponContainer"),d=$("#redemptionContainer"),i=$("#expirationTimer"),c=$("#redemptionTimer"),n=$("#voteContainer"),o=$("#offer"),r=$("#offerDescription"),s=$("#couponStatus"),m=$("#redeemStatus"),p=$("#days"),u=$("#hours"),h=$("#minutes"),v=$("#seconds"),l=($("#redeemMinutes"),$("#redeemSeconds"),$("#btnRedeem")),e=$("#btnClose"),t=$("#voteUp"),f=$("#voteDown"),w=($("#call"),$("#website"),$("#facebook"),$("#instagram"),$("#directions"),$("#redeemCode")),g=($("#qrcode"),$("#barcodeCode")),b=$("#redeemImageContainer"),y=$("#redeemQRcodeContainer"),T=!(previewMode=!1),x=(new Date).getTime()+"_check";function k(e){var t=Date.parse(e)-Date.now(),o=Math.floor(t/1e3%60),i=Math.floor(t/1e3/60%60),n=Math.floor(t/36e5%24),r=Math.floor(t/864e5);return{total:t<=0?0:t,days:r<=0?0:r,hours:n<=0?0:n,minutes:i<=0?0:i,seconds:o<=0?0:o}}function R(e){0<e.total?($("#seconds .count").text(e.seconds),$("#minutes .count").text(e.minutes),$("#hours .count").text(e.hours),$("#days .count").text(e.days)):(s.text("This coupon has ended, but stayed tuned for more."),p.hide(),u.hide(),h.hide(),v.hide(),i.hide(),l.hide(),n.hide(),s.addClass("expired"))}function M(){if(!previewMode){var e=$.cookie(mobilecouponHash+"_redeemed");if(1<e.length)var t="This coupon was redeemed on<br /><span>"+e+"</span>";else t="This coupon has been redeemed.";s.html(t),p.remove(),u.remove(),h.remove(),v.remove(),o.remove(),r.remove(),s.addClass("redeemed"),i.remove(),l.remove()}}function C(e,t){void 0===e||previewMode||$.ajax({type:"POST",async:!0,url:eventScriptPath_URL,data:{coupon:mobilecouponHash,event:e},cache:!1,dataType:"html",success:function(e){"function"==typeof t&&t()},error:function(e,t,o){}})}function I(e){void 0!==e&&void 0===$.cookie(mobilecouponHash+"_voted")&&window.confirm("Are you sure you want to vote this way?")&&(previewMode||(C(e),$.cookie(mobilecouponHash+"_voted",1,{expires:1095})),previewMode||(t.remove(),f.remove(),n.text("Thank you for your feedback!")))}function D(){a.show(),d.hide()}$.cookie(x,1,{expires:1095}),void 0===$.cookie(x)&&(T=!1),$.removeCookie(x),updateRedemptionTimer=function(e){0<e.total&&(0<e.days&&(e.minutes=1440*e.days+e.minutes),0<e.hours&&(e.minutes=60*e.hours+e.minutes),$("#redeemMinutes .count").text(e.minutes),$("#redeemSeconds .count").text(e.seconds))},initializemobileClock=function(e){if(/^\d+$/.test(e)){var t=previewMode?new Date:new Date($.cookie(mobilecouponHash+"_viewed"));t.setDate(t.getDate()+parseInt(e)),e=t}"undefined"!=typeof timeinterval&&clearInterval(timeinterval),s.text("EXPIRES IN..."),s.removeClass("expired"),p.show(),u.show(),h.show(),v.show(),i.show(),l.show(),n.show();var o=k(e);R(o),timeinterval=setInterval(function(){R(o=k(e)),o.total<=0&&clearInterval(timeinterval)},1e3)},l.click(function(){previewMode&&$(this).hasClass("inactive")||function(){if(!settingOnePerPerson||void 0!==$.cookie(mobilecouponHash+"_redeemed")||previewMode||window.confirm("Are you sure you want to redeem this now?")){if(!previewMode){var e=new Date,t=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear(),o=e.toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),i="undefined"!=typeof settingRedemptionReset&&"NaN"!=Number.parseInt(settingRedemptionReset)&&0!=Number.parseInt(settingRedemptionReset)?Number.parseInt(settingRedemptionReset):1095;$.cookie(mobilecouponHash+"_redeemed",t+" at "+o,{expires:i}),C("redemption")}settingOnePerPerson&&M(),m.text("Offer expires in..");var n="undefined"!=typeof settingRedemptionTimeout&&""!==settingRedemptionTimeout&&"NaN"!==parseInt(settingRedemptionTimeout)&&0<parseInt(settingRedemptionTimeout)&&parseInt(settingRedemptionTimeout);if(n){var r=new Date;r.setSeconds(r.getSeconds()+60*n);var s=k(r);updateRedemptionTimer(s),"undefined"!=typeof redemptionTimeinterval&&clearInterval(redemptionTimeinterval),redemptionTimeinterval=setInterval(function(){s=k(r),updateRedemptionTimer(s),s.total<=0&&(clearInterval(redemptionTimeinterval),previewMode||D())},1e3)}else previewMode||(m.hide(),c.hide());"redirect"!=settingRedemptionType&&(a.hide(),d.show())}}()}),e.click(function(){D()}),t.click(function(){I("vote_up")}),f.click(function(){I("vote_down")}),settingExpirationDate?initializemobileClock(settingExpirationDate):(i.hide(),s.empty()),g.text(settingRedemptionCode),w.text(settingRedemptionCode),"barcode"==settingRedemptionType?(b.hide(),y.show(),g.show(),w.hide()):(b.hide(),y.hide(),g.hide(),w.show()),settingOnePerPerson&&void 0!==$.cookie(mobilecouponHash+"_redeemed")&&M(settingRedemptionType),settingOnePerPerson&&!T&&function(){d.remove(),a.empty();var e=$("<div/>",{id:"cookieMessage",text:"This coupon requires your device's browser to accept cookies. Please enable cookies in your device's settings and refresh to try again."}),t=$("<a/>",{id:"cookieMessageRefreshButton",class:"button large grey",text:"Refresh Coupon",href:mobilecouponHash});e.appendTo(a),t.appendTo(a)}(),settingOnePerPerson?(m.show(),c.show()):(m.hide(),c.hide()),void 0===$.cookie(mobilecouponHash+"_voted")&&T||previewMode||n.remove(),$("#businessContainer a").each(function(){$(this).attr("href")||$(this).hide(),0<$(this).parent().children(":visible").length||$(this).parent().hide()}),$("#socialContainer a").each(function(){$(this).attr("href")||$(this).hide(),0<$(this).parent().children(":visible").length||$(this).parent().hide()}),$("#voteContainer a span").each(function(){$(this).text()||$(this).parent().hide(),0<$(this).parent().parent().children(":visible").length||$(this).parent().parent().hide()})});